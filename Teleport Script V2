-- ================= LOAD RAYFIELD =================
local Rayfield = loadstring(game:HttpGet("https://sirius.menu/rayfield"))()

-- ================= SERVICES =================
local Players = game:GetService("Players")
local Teams = game:GetService("Teams")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer

-- ================= WINDOW =================
local Window = Rayfield:CreateWindow({
    Name = "TP HUB | Teleport System (‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏õ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)",
    LoadingTitle = "Loading TP HUB (‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î)",
    LoadingSubtitle = "Rayfield UI",
    ToggleUIKeybind = "K",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "TPHubThai",
        FileName = "Config"
    }
})

-- ================= TAB =================
local TeleportTab = Window:CreateTab(
    "Teleport (‡∏ß‡∏≤‡∏õ)", 
    4483362458
)

-- ================= VARIABLES =================
local selectedPlayer
local offsetMode = "Front (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤)"
local tpMode = "Instant Teleport (‡∏ß‡∏≤‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)"
local distance = 5

local lookAtTargetEnabled = false
local followConnection

-- üîÅ LOOP ALL
local loopAllEnabled = false
local loopTask
local loopDelay = 0.25 -- Hold Time Per Player (‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)

local teamFilterMode = "All Teams (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)"
local selectedTeamName

-- ================= HELPERS =================
local function getHRP(plr)
    local char = plr.Character or plr.CharacterAdded:Wait()
    return char:WaitForChild("HumanoidRootPart")
end

local function getPlayerList()
    local t = {}
    for _,p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            table.insert(t, p.Name)
        end
    end
    return t
end

-- ================= OFFSET =================
local function getOffsetCF(targetHRP)
    local look = targetHRP.CFrame.LookVector

    if offsetMode == "Front (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤)" then
        return targetHRP.CFrame + (look * distance)
    elseif offsetMode == "Back (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á)" then
        return targetHRP.CFrame - (look * distance)
    elseif offsetMode == "Above (‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)" then
        return targetHRP.CFrame + Vector3.new(0, distance, 0)
    elseif offsetMode == "Below (‡πÉ‡∏ï‡πâ‡πÄ‡∏ó‡πâ‡∏≤)" then
        return targetHRP.CFrame - Vector3.new(0, distance, 0)
    end

    return targetHRP.CFrame
end

-- ================= LOOK AT TARGET =================
local function applyLookAt(myHRP, targetHRP)
    if not lookAtTargetEnabled then return end

    local myPos = myHRP.Position
    local targetPos = Vector3.new(
        targetHRP.Position.X,
        myPos.Y,
        targetHRP.Position.Z
    )

    myHRP.CFrame = CFrame.lookAt(myPos, targetPos)
end

-- ================= STOP FOLLOW =================
local function stopFollow()
    if followConnection then
        followConnection:Disconnect()
        followConnection = nil
    end
end

-- ================= SINGLE TELEPORT =================
local function startTeleport()
    stopFollow()
    if not selectedPlayer then return end

    local plr = Players:FindFirstChild(selectedPlayer)
    if not (plr and plr.Character) then return end

    local targetHRP = getHRP(plr)
    local myHRP = getHRP(LocalPlayer)

    if tpMode == "Instant Teleport (‡∏ß‡∏≤‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)" then
        myHRP.CFrame = getOffsetCF(targetHRP)
        applyLookAt(myHRP, targetHRP)

    elseif tpMode == "Tween Teleport (‡∏ß‡∏≤‡∏õ‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô)" then
        local tween = TweenService:Create(
            myHRP,
            TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out),
            {CFrame = getOffsetCF(targetHRP)}
        )
        tween:Play()
        tween.Completed:Once(function()
            applyLookAt(myHRP, targetHRP)
        end)

    elseif tpMode == "Follow Loop (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°)" then
        followConnection = RunService.Heartbeat:Connect(function()
            if not plr.Character then stopFollow() return end
            myHRP.CFrame = getOffsetCF(targetHRP)
            applyLookAt(myHRP, targetHRP)
        end)
    end
end

-- ================= TEAM FILTER =================
local function passTeam(plr)
    if teamFilterMode == "All Teams (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)" then
        return true
    end

    if not plr.Team or not LocalPlayer.Team then
        return false
    end

    if teamFilterMode == "Same Team (‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤)" then
        return plr.Team == LocalPlayer.Team
    elseif teamFilterMode == "Enemy Team (‡∏ó‡∏µ‡∏°‡∏®‡∏±‡∏ï‡∏£‡∏π)" then
        return plr.Team ~= LocalPlayer.Team
    elseif teamFilterMode == "Select Team (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏≠‡∏á)" then
        return plr.Team.Name == selectedTeamName
    end

    return false
end

-- ================= LOOP ALL PLAYERS =================
local function startLoopAll()
    if loopTask then return end

    loopTask = task.spawn(function()
        while loopAllEnabled do
            local myHRP = getHRP(LocalPlayer)

            for _,plr in pairs(Players:GetPlayers()) do
                if not loopAllEnabled then break end

                if plr ~= LocalPlayer and plr.Character and passTeam(plr) then
                    local hrp = getHRP(plr)
                    myHRP.CFrame = getOffsetCF(hrp)
                    applyLookAt(myHRP, hrp)
                    task.wait(loopDelay)
                end
            end

            task.wait(0.1)
        end
        loopTask = nil
    end)
end

-- ================= UI =================
TeleportTab:CreateSection("Single Teleport (‡∏ß‡∏≤‡∏õ‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô)")

local PlayerDropdown = TeleportTab:CreateDropdown({
    Name = "Select Player (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)",
    Options = getPlayerList(),
    Callback = function(v)
        selectedPlayer = v[1]
    end
})

TeleportTab:CreateButton({
    Name = "Refresh Player List (‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)",
    Callback = function()
        PlayerDropdown:Refresh(getPlayerList())
    end
})

TeleportTab:CreateDropdown({
    Name = "Teleport Position (‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ß‡∏≤‡∏õ)",
    Options = {
        "Front (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤)",
        "Back (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏•‡∏±‡∏á)",
        "Above (‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô)",
        "Below (‡πÉ‡∏ï‡πâ‡πÄ‡∏ó‡πâ‡∏≤)"
    },
    CurrentOption = {"Front (‡∏î‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡πâ‡∏≤)"},
    Callback = function(v)
        offsetMode = v[1]
    end
})

TeleportTab:CreateSlider({
    Name = "Distance (‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á)",
    Range = {3,20},
    Increment = 1,
    CurrentValue = distance,
    Callback = function(v)
        distance = v
    end
})

TeleportTab:CreateDropdown({
    Name = "Teleport Mode (‡πÇ‡∏´‡∏°‡∏î‡∏ß‡∏≤‡∏õ)",
    Options = {
        "Instant Teleport (‡∏ß‡∏≤‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)",
        "Tween Teleport (‡∏ß‡∏≤‡∏õ‡πÄ‡∏ô‡∏µ‡∏¢‡∏ô)",
        "Follow Loop (‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°)"
    },
    CurrentOption = {"Instant Teleport (‡∏ß‡∏≤‡∏õ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)"},
    Callback = function(v)
        tpMode = v[1]
        stopFollow()
    end
})

TeleportTab:CreateToggle({
    Name = "Lock Face Target (‡∏•‡πá‡∏≠‡∏Å‡∏´‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢)",
    CurrentValue = false,
    Callback = function(v)
        lookAtTargetEnabled = v
    end
})

TeleportTab:CreateButton({
    Name = "Start Teleport (‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏≤‡∏õ)",
    Callback = startTeleport
})

TeleportTab:CreateButton({
    Name = "Stop Follow (‡∏´‡∏¢‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°)",
    Callback = stopFollow
})

TeleportTab:CreateSection("Loop Teleport (‡∏ß‡∏≤‡∏õ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)")

TeleportTab:CreateSlider({
    Name = "Hold Time Per Player (‡πÄ‡∏ß‡∏•‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏ï‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô)",
    Range = {0.1,3},
    Increment = 0.05,
    CurrentValue = loopDelay,
    Callback = function(v)
        loopDelay = v
    end
})

TeleportTab:CreateDropdown({
    Name = "Team Filter (‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏µ‡∏°)",
    Options = {
        "All Teams (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)",
        "Same Team (‡∏ó‡∏µ‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤)",
        "Enemy Team (‡∏ó‡∏µ‡∏°‡∏®‡∏±‡∏ï‡∏£‡∏π)",
        "Select Team (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡∏°‡πÄ‡∏≠‡∏á)"
    },
    CurrentOption = {"All Teams (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)"},
    Callback = function(v)
        teamFilterMode = v[1]
    end
})

local function getTeamNames()
    local t = {}
    for _,team in pairs(Teams:GetTeams()) do
        table.insert(t, team.Name)
    end
    return t
end

TeleportTab:CreateDropdown({
    Name = "Select Team Name (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°)",
    Options = getTeamNames(),
    Callback = function(v)
        selectedTeamName = v[1]
    end
})

TeleportTab:CreateToggle({
    Name = "Loop All Players (‡∏•‡∏π‡∏õ‡∏ß‡∏≤‡∏õ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î)",
    CurrentValue = false,
    Callback = function(v)
        loopAllEnabled = v
        if v then
            startLoopAll()
        end
    end
})
